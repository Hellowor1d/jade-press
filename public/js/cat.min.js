!function(){var t=Vue.$alert;Vue.use(zPagenav);var e=new Vue({el:"body",data:{loaded:!0,tab:"list",form1:null,form2:null,form3:null,formData1:{page:1,pageSize:100,maxLink:5,parentId:"__root_cat"},formData2:{},formData3:{},currentEditItem:{},total:0,onSubmit1:!1,onSubmit2:!1,onDel:!1,currentDelItem:{},state:"list",editIndex:0,list:[]},events:{"page-change":function(t){this.getList()}},methods:{setTab:function(t){this.tab=t},checkShow:function(t,e){return"user-created"!==t.type&&"del"===e?!1:"list"===this.state?!0:t._id===this.currentEditItem._id||t._id===this.currentDelItem._id},formHook2:function(t){this._form2=t},setPristine:function(){var t=this;Vue.nextTick(function(){t._form2.setPristine()})},setDirty:function(){this._form2.setDirty()},edit:function(t,e){this.state="edit",this.currentEditItem=Object.assign({},t),this.editIndex=e,this.formData3=Object.assign({},this.currentEditItem)},del:function(t){this.state="del",this.currentDelItem=Object.assign({},t)},cancelEdit:function(t){this.state="list",this.currentEditItem={}},cancel:function(t){this.state="list",this.currentDelItem={}},add:function(){var e=this;if(!e.onSubmit2){if(e.form2.$invalid)return e.setDirty();e.onSubmit2=!0,$.ajax({type:"post",url:h5.host+"/api/cat/add",data:e.formData2}).then(function(i){e.onSubmit2=!1;var r=i;r.errorMsg?t(r.errorMsg,"danger","#msg2"):r.errs?t(r.errs.join(";"),"danger","#msg2"):(e.formData2={},e.setPristine(),t("add new category done","success","#msg2",1e4),e.total++,e.list.push(r.result))},function(i){e.onSubmit2=!1,t("add cat failed","danger","#msg1")})}},update:function(){var e=this;if(!e.onSubmit3&&!e.form3.$invalid){var i={name:e.formData3.name,desc:e.formData3.desc,slug:e.formData3.slug,_id:e.formData3._id};e.onSubmit3=!0,$.ajax({type:"post",url:h5.host+"/api/cat/update",data:i}).then(function(i){e.onSubmit3=!1;var r=i;r.errorMsg?t(r.errorMsg,"danger","#msg3"):r.errs?t(r.errs.join(";"),"danger","#msg3"):(e.list.$set(e.editIndex,e.formData3),e.state="list",e.currentEditItem={})},function(i){e.onSubmit3=!1,t("update cat failed","danger","#msg3")})}},delConfirm:function(e,i){var r=this;if(!r.onDel){var n={_id:this.currentDelItem._id};r.onDel=!0,$.ajax({type:"post",url:h5.host+"/api/cat/del",data:n}).then(function(e){r.onDel=!1;var n=e;n.errorMsg?t(n.errorMsg,"danger","#msg-item",1e4):n.errs?t(n.errs.join(";"),"danger","#msg-item",1e4):(r.list.splice(i,1),r.total--,r.state="list",t("delete done","success","#msg3",1e4))},function(e){r.onDel=!1,t("del failed","danger","#msg-item",1e4)})}},getList:function(){var e=this;e.onSubmit1||e.form1.$invalid||(e.onSubmit1=!0,$.ajax({type:"post",url:h5.host+"/api/cat/get",data:e.formData1}).then(function(i){e.onSubmit1=!1;var r=i;r.errorMsg||r.errs?t(r.errorMsg||r.errs.join(";"),"danger","#msg1"):(e.total=r.total,e.list=r.result)},function(i){e.onSubmit1=!1,t("get list failed","danger","#msg1")}))}}});e.getList()}();