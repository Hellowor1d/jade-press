!function(){var t=Vue.$alert;Vue.use(zPagenav);var e=new Vue({el:"body",data:{loaded:!0,tab:"list",form1:null,form2:null,form3:null,formData1:{page:1,pageSize:20,maxLink:5,fields:{name:1,group:1,email:1}},formData2:{group:{},resetPassword:!0},formData3:{},currentEditItem:{},total:0,onSubmit1:!1,onSubmit2:!1,onDel:!1,currentDelItem:{},state:"list",editIndex:0,list:[],onloadGroup:!1,groups:[],groupOptions:[]},methods:{setTab:function(t){this.tab=t},validateGroup2:function(){return this.formData2.group._id},validateGroup3:function(){return this.formData3.group._id},validatePass2:function(){var t=this.formData2.password;return/^[0-9A-Za-z]{6,16}$/.test(t)&&/[A-Za-z]/.test(t)&&/[0-9]/.test(t)},validateGroup3:function(){var t=this.formData3.password;return/^[0-9A-Za-z]{6,16}$/.test(t)&&/[A-Za-z]/.test(t)&&/[0-9]/.test(t)},checkShow:function(t){return"built-in"===t.type?!1:"list"===this.state?!0:t._id===this.currentEditItem._id||t._id===this.currentDelItem._id},selectGroup:function(t,e){e.group=t},checkGroup:function(t,e){return(e.group||{})._id===t._id},formHook2:function(t){this._form2=t},setPristine:function(){var t=this;Vue.nextTick(function(){t._form2.setPristine()})},setDirty:function(){this._form2.setDirty()},edit:function(t,e){this.state="edit",this.editIndex=e,this.currentEditItem=Object.assign({},t),this.formData3=Object.assign({},t)},del:function(t){this.state="del",this.currentDelItem=Object.assign({},t)},cancelEdit:function(t){this.state="list",this.currentEditItem={}},cancel:function(t){this.state="list",this.currentDelItem={}},reset:function(){this.formData2={group:{},resetPassword:!0}},add:function(){var e=this;if(!e.onSubmit2){if(e.form2.$invalid)return this.setDirty();e.onSubmit2=!0,$.ajax({type:"post",url:h5.host+"/api/user/add",data:e.formData2,dataType:"json"}).then(function(r){e.onSubmit2=!1;var i=r;i.errorMsg||i.errs?t(i.errorMsg||i.errs.join(";"),"danger","#msg2"):(e.reset(),e.setPristine(),t("add new user done","success","#msg2",1e4),e.total++,e.list.push(i.result))},function(r){e.onSubmit2=!1,t("add user failed","danger","#msg2")})}},update:function(){var e=this;e.onSubmit3||e.form3.$invalid||(e.onSubmit3=!0,$.ajax({type:"post",url:h5.host+"/api/user/update",data:e.formData3,dataType:"json"}).then(function(r){e.onSubmit3=!1;var i=r;i.errorMsg||i.errs?t(i.errorMsg||i.errs.join(";"),"danger","#msg31",1e4):(e.list.$set(e.editIndex,e.formData3),e.state="list",e.formData3={},e.currentEditItem={})},function(r){e.onSubmit3=!1,t("update user failed","danger","#msg31",1e4)}))},delConfirm:function(e,r){var i=this;if(!i.onDel){var s={_id:this.currentDelItem._id};i.onDel=!0,$.ajax({type:"post",url:h5.host+"/api/user/del",data:s}).then(function(e){i.onDel=!1;var s=e;s.errorMsg||s.errs?t(s.errorMsg||s.errs.join(";"),"danger","#msg-item",1e4):(i.list.splice(r,1),i.total--,i.state="list",t("delete done","success","#msg3",1e4))},function(e){i.onDel=!1,t("delete failed","danger","#msg-item")})}},getList:function(){var e=this;e.onSubmit1||e.form1.$invalid||(e.onSubmit1=!0,$.ajax({type:"post",url:h5.host+"/api/user/get",data:e.formData1}).then(function(r){e.onSubmit1=!1;var i=r;i.errorMsg||i.errs?t(i.errorMsg||i.errs.join(";"),"danger","#msg1"):(e.total=i.total,e.list=i.result)},function(r){e.onSubmit1=!1,t("get list failed","danger","#msg1")}))},getGroups:function(){var e=this;e.onloadGroup||(e.onloadGroup=!0,$.ajax({type:"post",url:h5.host+"/api/group/get",data:{pageSize:1e3,page:1,fields:{name:1,desc:1,access:1}}}).then(function(r){e.onloadGroup=!1;var i=r;i.errorMsg||i.errs?t(i.errorMsg||i.errs.join(";"),"danger","#msg1"):(e.groups=i.result,e.groupOptions=[{_id:"",name:"all groups"}].concat(e.groups),e.formData1.groupId=e.groupOptions[0]._id)},function(r){e.onloadGroup=!1,t("get group list failed","danger","#msg1")}))}},events:{"page-change":function(t){this.getGroups()}}});e.getGroups(),e.getList()}();